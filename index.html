
<!DOCTYPE html>
<html>
  <head>
    <title>ETH Chart with Buy/Sell Signals</title>
    <meta charset="UTF-8" />
    <style>
      body {
        margin: 0;
        background: #111;
        color: white;
        font-family: Arial;
        text-align: center;
      }
      #chart {
        width: 100%;
        height: 600px;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <h1>ETH Live Chart with Buy/Sell Signals</h1>
    <div id="chart"></div>

    <!-- Charting Library -->
    <script src="https://unpkg.com/lightweight-charts@4.0.0/dist/lightweight-charts.standalone.production.js"></script>

    <script>
      const chart = LightweightCharts.createChart(document.getElementById('chart'), {
        width: window.innerWidth,
        height: 600,
        layout: {
          background: { color: '#111' },
          textColor: '#fff',
        },
        grid: {
          vertLines: { color: '#333' },
          horzLines: { color: '#333' },
        },
        timeScale: { timeVisible: true, secondsVisible: false },
      });

      const candleSeries = chart.addCandlestickSeries();

      async function fetchData() {
        const res = await fetch('https://api.binance.com/api/v3/klines?symbol=ETHUSDT&interval=1m&limit=100');
        const data = await res.json();

        const chartData = data.map(d => ({
          time: d[0] / 1000,
          open: parseFloat(d[1]),
          high: parseFloat(d[2]),
          low: parseFloat(d[3]),
          close: parseFloat(d[4])
        }));

        candleSeries.setData(chartData);
        plotSignals(chartData);
      }

      function plotSignals(data) {
        const markers = [];

        for (let i = 14; i < data.length; i++) {
          const closes = data.slice(i - 14, i).map(d => d.close);
          const avg = closes.reduce((a, b) => a + b) / closes.length;
          const rsi = 100 - (100 / (1 + (closes[closes.length - 1] / avg)));

          const emaShort = getEMA(data, i, 5);
          const emaLong = getEMA(data, i, 10);

          if (emaShort > emaLong && rsi < 70) {
            markers.push({
              time: data[i].time,
              position: 'belowBar',
              color: 'lime',
              shape: 'arrowUp',
              text: 'Buy'
            });
          } else if (emaShort < emaLong && rsi > 30) {
            markers.push({
              time: data[i].time,
              position: 'aboveBar',
              color: 'red',
              shape: 'arrowDown',
              text: 'Sell'
            });
          }
        }

        candleSeries.setMarkers(markers);
      }

      function getEMA(data, index, period) {
        const prices = data.slice(index - period, index).map(d => d.close);
        const k = 2 / (period + 1);
        let ema = prices[0];

        for (let i = 1; i < prices.length; i++) {
          ema = prices[i] * k + ema * (1 - k);
        }

        return ema;
      }

      fetchData();
      setInterval(fetchData, 60000); // update every 60 seconds
    </script>
  </body>
</html>
