
<!DOCTYPE html>
<html>
  <head>
    <title>ETH Trend Signal Chart</title>
    <meta charset="UTF-8" />
    <style>
      body {
        margin: 0;
        background: #111;
        color: white;
        font-family: Arial;
        text-align: center;
      }
      #chart {
        width: 100%;
        height: 600px;
      }
    </style>
  </head>
  <body>
    <h1>ETH Trend Start Buy/Sell Signals</h1>
    <div id="chart"></div>

    <!-- Charting Library -->
    <script src="https://unpkg.com/lightweight-charts@4.0.0/dist/lightweight-charts.standalone.production.js"></script>

    <script>
      const chart = LightweightCharts.createChart(document.getElementById('chart'), {
        width: window.innerWidth,
        height: 600,
        layout: {
          background: { color: '#111' },
          textColor: '#fff',
        },
        grid: {
          vertLines: { color: '#333' },
          horzLines: { color: '#333' },
        },
        timeScale: { timeVisible: true, secondsVisible: false },
      });

      const candleSeries = chart.addCandlestickSeries();

      async function fetchData() {
        const res = await fetch('https://api.binance.com/api/v3/klines?symbol=ETHUSDT&interval=1m&limit=200');
        const raw = await res.json();

        const candles = raw.map(d => ({
          time: d[0] / 1000,
          open: +d[1],
          high: +d[2],
          low: +d[3],
          close: +d[4],
        }));

        candleSeries.setData(candles);
        plotTrendSignals(candles);
      }

      function calculateEMA(data, period) {
        const k = 2 / (period + 1);
        let emaArray = [];
        let ema = data[0];

        for (let i = 0; i < data.length; i++) {
          ema = data[i] * k + ema * (1 - k);
          emaArray.push(ema);
        }

        return emaArray;
      }

      function plotTrendSignals(data) {
        const closes = data.map(d => d.close);
        const emaShort = calculateEMA(closes, 5);
        const emaLong = calculateEMA(closes, 20);

        const markers = [];
        let lastSignal = null;

        for (let i = 20; i < data.length; i++) {
          if (emaShort[i] > emaLong[i] && lastSignal !== 'buy') {
            markers.push({
              time: data[i].time,
              position: 'belowBar',
              color: 'lime',
              shape: 'arrowUp',
              text: 'Buy Start'
            });
            lastSignal = 'buy';
          } else if (emaShort[i] < emaLong[i] && lastSignal !== 'sell') {
            markers.push({
              time: data[i].time,
              position: 'aboveBar',
              color: 'red',
              shape: 'arrowDown',
              text: 'Sell Start'
            });
            lastSignal = 'sell';
          }
        }

        candleSeries.setMarkers(markers);
      }

      fetchData();
      setInterval(fetchData, 60000); // update every 1 minute
    </script>
  </body>
</html>
